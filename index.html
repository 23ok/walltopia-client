<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Walltopia Client</title>
  <style>
    body { margin: 0; background: #000; color: #fff; display: flex; flex-direction: column; align-items: center; }
    #game { border: 1px solid #555; background: #222; }
    #status { margin: 8px; }
  </style>
</head>
<body>
  <h1>Walltopia Client</h1>
  <p id="status">Conectando...</p>
  <canvas id="game" width="800" height="400"></canvas>

  <!-- Socket.IO client -->
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <script>
    // =============================
    // Configuração do token e URL
    // =============================
    // Substitua com o seu token JWT obtido no /login
    const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxNzQ2MDgwOTEzOTA2IiwiZW1haWwiOiJub3ZvdXN1YXJpb0BleGVtcGxvLmNvbSIsImlhdCI6MTc0NjA4MDkyOCwiZXhwIjoxNzQ2MDg4MTI4fQ.0mNKFr7_dQB5x8-3AReJ8OB14gOGgY2FDMnloPTEBN4';
    // Substitua com a URL do seu servidor Replit (sem barra no final)
    const SERVER_URL = 'https://0803cfd3-ab2a-4b96-bf35-eb788a29f988-00-2jhigdrm8gnnu.worf.replit.dev';

    // =============================
    // Conexão Socket.IO autenticada
    // =============================
    const socket = io(SERVER_URL, {
      auth: { token }
    });

    socket.on('connect_error', err => {
      alert('Erro de conexão: ' + err.message);
      document.getElementById('status').textContent = 'Erro: ' + err.message;
    });

    socket.on('connect', () => {
      console.log('Conectado ao servidor, socket id:', socket.id);
      document.getElementById('status').textContent = 'Conectado como ' + socket.id;
    });

    // =============================
    // Estado do jogador e outros
    // =============================
    const otherPlayers = {};
    let x = 50, y = 350;

    // =============================
    // Recebendo eventos do servidor
    // =============================
    socket.on('playerMoved', ({ id, x: px, y: py }) => {
      otherPlayers[id] = { x: px, y: py };
    });

    socket.on('playerDisconnected', id => {
      delete otherPlayers[id];
    });

    // =============================
    // Configuração do canvas
    // =============================
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // =============================
    // Movimentação local e envio
    // =============================
    document.addEventListener('keydown', e => {
      switch (e.key) {
        case 'a': x -= 5; break;
        case 'd': x += 5; break;
        case 'w': y -= 5; break;
        case 's': y += 5; break;
      }
      // Envia posição ao servidor
      socket.emit('move', { x, y });
    });

    // =============================
    // Desenho no canvas (30 FPS)
    // =============================
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Desenha jogador local (vermelho)
      ctx.fillStyle = 'red';
      ctx.fillRect(x, y - 20, 20, 20);

      // Desenha outros jogadores (verde)
      ctx.fillStyle = 'green';
      for (const id in otherPlayers) {
        const p = otherPlayers[id];
        ctx.fillRect(p.x, p.y - 20, 20, 20);
      }
    }

    setInterval(draw, 1000 / 30);
  </script>
</body>
</html>
