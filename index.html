<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Walltopia - Multiplayer</title>
  <style>
    body { margin: 0; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; }
    .top-bar { display: flex; align-items: center; justify-content: space-between; background: #333; color: #fff; padding: 8px; }
    .middle { flex: 1; position: relative; background: #000; }
    #game-container { width: 100%; height: 100%; }
    .bottom-section { display: flex; }
    .chat { flex: 1; background: #222; color: #fff; padding: 8px; min-height: 150px; overflow-y: auto; }
    .inventory { width: 200px; background: #444; color: #fff; padding: 8px; }
    .inventory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-top: 8px; }
    .slot { width: 40px; height: 40px; border: 1px solid #fff; }
    .actions { background: #555; color: #fff; padding: 8px; display: flex; justify-content: space-around; }
    button { background: #666; border: none; color: #fff; padding: 6px 12px; cursor: pointer; }
    button:hover { background: #777; }
  </style>
  <!-- Biblioteca Socket.IO cliente -->
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <!-- Biblioteca Phaser 3 -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
</head>
<body>
  <div class="top-bar">
    <div>Walltopia</div>
    <div>Level: 1 | XP: 0/100</div>
    <div>Zoom: <button id="zoom-out">-</button> <button id="zoom-in">+</button></div>
  </div>
  <div class="middle">
    <div id="game-container"></div>
  </div>
  <div class="bottom-section">
    <div class="chat">
      <p>Sistema de chat inicializado...</p>
    </div>
    <div class="inventory">
      <div>Invent√°rio (3√ó3)</div>
      <div class="inventory-grid">
        <div class="slot"></div><div class="slot"></div><div class="slot"></div>
        <div class="slot"></div><div class="slot"></div><div class="slot"></div>
        <div class="slot"></div><div class="slot"></div><div class="slot"></div>
      </div>
      <div style="margin-top: 12px;">Vestir: [slot roupa]</div>
    </div>
  </div>
  <div class="actions">
    <button>‚öîÔ∏è Bater (1)</button>
    <button>ü•æ Pular (2)</button>
    <button>ü™ù Agachar (3)</button>
    <button>üñêÔ∏è Pegar (4)</button>
    <button>üç¥ Comer (5)</button>
    <button>üëï Vestir (6)</button>
  </div>

  <script>
    // ----------------------------------------
    // 1) Conecta ao servidor WebSocket (substitua a URL)
    // ----------------------------------------
    const socket = io('https://0803cfd3-ab2a-4b96-bf35-eb788a29f988-00-2jhigdrm8gnnu.worf.replit.dev'); 
    const otherPlayers = {}; // guarda sprites dos outros jogadores

    socket.on('connect', () => {
      console.log('Conectado ao servidor com id', socket.id);
    });

    socket.on('playerMoved', data => {
      const scene = game.scene.scenes[0];
      if (!otherPlayers[data.id]) {
        // cria um ret√¢ngulo verde para esse outro jogador
        otherPlayers[data.id] = scene.add.rectangle(data.x, data.y, 32, 48, 0x00ff00);
      } else {
        otherPlayers[data.id].x = data.x;
        otherPlayers[data.id].y = data.y;
      }
    });

    socket.on('playerDisconnected', id => {
      if (otherPlayers[id]) {
        otherPlayers[id].destroy();
        delete otherPlayers[id];
      }
    });

    // ----------------------------------------
    // 2) Configura√ß√£o do Phaser
    // ----------------------------------------
    const config = {
      type: Phaser.AUTO,
      parent: 'game-container',
      width: window.innerWidth,
      height: window.innerHeight 
              - document.querySelector('.top-bar').offsetHeight
              - document.querySelector('.bottom-section').offsetHeight
              - document.querySelector('.actions').offsetHeight,
      physics: { default: 'arcade', arcade: { gravity: { y: 500 }, debug: false } },
      scene: { preload, create, update }
    };
    const game = new Phaser.Game(config);

    function preload() {
      // Sem assets externos
    }

    function create() {
      const { width, height } = this.scale;

      // Grid de c√©lulas 200√ó200
      const cellSize = 200;
      const grid = this.add.graphics();
      grid.lineStyle(2, 0x00ff00, 0.5);
      for (let x = 0; x <= width; x += cellSize) {
        grid.moveTo(x, 0); grid.lineTo(x, height);
      }
      for (let y = 0; y <= height; y += cellSize) {
        grid.moveTo(0, y); grid.lineTo(width, y);
      }
      grid.strokePath();

      // Textura simples para o jogador (ret√¢ngulo vermelho)
      const g = this.add.graphics();
      g.fillStyle(0xff0000, 1);
      g.fillRect(0, 0, 32, 48);
      g.generateTexture('player', 32, 48);
      g.destroy();

      // Cria o sprite do jogador
      this.player = this.physics.add.sprite(width/2, height/2, 'player');
      this.player.setCollideWorldBounds(true);

      // Controles
      this.keys = this.input.keyboard.addKeys({ left: 'A', right: 'D', jump: 'SPACE' });

      // C√¢mera
      this.cameras.main.setBounds(0, 0, width, height);
      this.cameras.main.startFollow(this.player);

      // Zoom via bot√µes
      document.getElementById('zoom-in').addEventListener('click', () => {
        this.cameras.main.zoom += 0.1;
      });
      document.getElementById('zoom-out').addEventListener('click', () => {
        this.cameras.main.zoom = Math.max(0.5, this.cameras.main.zoom - 0.1);
      });
    }

    function update() {
      const speed = 200;
      const onGround = this.player.body.blocked.down;

      // Movimento horizontal
      if (this.keys.left.isDown) {
        this.player.setVelocityX(-speed);
      } else if (this.keys.right.isDown) {
        this.player.setVelocityX(speed);
      } else {
        this.player.setVelocityX(0);
      }

      // Pulo
      if (Phaser.Input.Keyboard.JustDown(this.keys.jump) && onGround) {
        this.player.setVelocityY(-400);
      }

      // Emite posi√ß√£o ao servidor
      socket.emit('move', { x: this.player.x, y: this.player.y });
    }
  </script>
</body>
</html>
